<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<title>信息列表</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<link type="text/css"  rel="stylesheet" href="__PUBLIC__/home/style/style.css"/>
    <style>
        *{ margin: 0;padding: 0}
        .black_overlay{
            display: none;
            position: absolute;
            top: 0%;
            left: 0%;
            width: 100%;
            height: 100%;
            background-color: black;
            z-index:1001;
            -moz-opacity: 0.8;
            opacity:.80;
            filter: alpha(opacity=88);
        }
        .white_content {
            display: none;
            position: absolute;
            top: 45%;
            left: 10%;;
            width: 80%;
            height:25%;
            margin: 0 auto;

            background-color: #FFF;
            z-index:1002;
            overflow: auto;
            text-align:center;
        }
        .white_content .worn{
            color: #FF5A3E; font-size: 0.9em; border-bottom: #CCC 1px solid;
            height: 35px; line-height: 35px; margin-bottom:8%}
        .white_content p{
            font:18px 微软雅黑;
            text-align:center;

            margin-bottom:10px;
        }
        .white_content a{
            font:18px 微软雅黑 !important;
            text-decoration:none !important;
            background:#4AC9F6;
            padding:3px 30px;
            color:#fff;
            border-radius:5px;

        }
        .white_content a:hover{
            font:18px 微软雅黑 !important;
            text-decoration:none !important;
            background:#666;
            padding:3px 30px;
            color:#fff;
            border-radius:5px;
        }
    </style>
<script type="text/javascript" src="__PUBLIC__/home/js/jquery-2.2.4.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  var indexFlag="{$index}";
  if(indexFlag==''){
    $("#tabhost li:eq(0)").addClass("current3");//使第一个li追加css样式，（做到最原始的样子）
    $("#content .point:not(:first)").hide();//使内容除了第一个都隐藏，先写出原来的的样式
  }else{
      $("#tabhost li:eq("+(indexFlag-1)+")").addClass("current3");//使第一个li追加css样式，（做到最原始的样子）
      //$("#content .point").eq(indexFlag).show().siblings().hide();
  }
$("#tabhost li").click(function(){
$(this).addClass("current3").siblings().removeClass("current3");//点击的li追加样式并找到其它的兄弟元素使它去掉样式
 var index=$(this).index();//得到点击的li的序列号
 if(index==0){
     window.location.href="{:U('index')}"
 }
 if(index==2){
 }
 if(index==3){
 }
 })
})
</script>
<script type="text/javascript">
$(document).ready(function(){
	$(".padlock").click(function(){
		$(".filtrate").hide()
		});
		
	})
</script>
<script type="text/javascript">
$(document).ready(function(){
	$(".screen").click(function(){
		$(".filtrate").show()
		});
		
	})
</script>

</head>

<body style="background:#EBEBEB">
<include file="Common:common"/>
 <div id="box">
      <div id="header" style="margin-bottom:0%">
          <a href="{:U('Index/index')}">
             <div class="return">
                 <img src="__PUBLIC__/home/images/fanhui.png" width="26" height="26"/>
             </div>
          </a>
              <div class="indent">信息列表</div>
       </div>
    <div class="tab">
            <ul id="tabhost">
                <li>
                全部
                </li>
                <script type="text/javascript">
                       function selctOrder(obj){
                             var seleNum=$(obj).find("option:selected").val();
                             $("#selectOrder").val(seleNum);
                             $("#whereCaseSelect").val($("#whereCaseId").val());
                             $("#orderCondition").submit();
                       }
                       function selctVal(obj){
                             var seleNum=$(obj).find("option:selected").val();
                             $("#selectWhere").val(seleNum);
                             $("#selectOrderOrder").val($("#orderConditionId").val());
                             $("#selectCondition").submit();
                       }
                </script>
                <li>
                   <div style="display:none">
                          <form action="{:U('index')}" method="post" id="orderCondition"><!--排序-->
                                  <input name="orderCondition" value="1" id="selectOrder">
                                  <input name="whereOrigin" value="sy" id="whereCaseSelect">
                                  <input name="index" value="2">
                          </form>
                          <form action="{:U('index')}" method="post" id="selectCondition"><!--筛选-->
                                  <input name="whereOrigin" value="1" id="selectWhere">
                                  <input name="orderCondition" value="1" id="selectOrderOrder">
                                  <input name="index" value="3">
                          </form>
                   </div>
                  <select class="wipe" onchange="selctOrder(this)">
                      <option value="1" <if condition="$orderCondition eq 1">selected="selected"</if> >按时间排序</option>
                      <option value="2" <if condition="$orderCondition eq 2">selected="selected"</if> >就近排序</option>
                    </select>
                </li>
                <li style="border-right:none" class="screen">
                 <select class="wipe" onchange="selctVal(this)">
                      <option selected="selected" value="sy">筛选(全部)</option>
                     <option value="cg" <if condition="$whereCase eq 'cg' ">selected="selected"</if> >采购信息</option>
                      <option value="gh" <if condition="$whereCase eq 'gh' ">selected="selected"</if>>供货信息</option>
                    <!-- <option value="qc" <if condition="$whereCase eq 'qc' ">selected="selected"</if> >求车信息</option>
                      <option value="cy" <if condition="$whereCase eq 'cy' ">selected="selected"</if> >车源信息</option>-->
                    </select>
                </li>
            </ul>
            <div id="content">
               <!--全部开始-->
               <div class="point">
               <!--开始-->
               <span id="inserPoint">
                 <div style="display:none">
                 <span id="cloneObj">
                         <div class="personne" >
                         <input type="hidden" name="mid" value="{$val['id']}">
                      <dl class="personne-left">
                        <dt><img src="__ROOT__/{$val['headimgurl']}" width="55" style="border-radius: 50%;" height="57" /></dt>
                        <dd><span>{$val['username']}</span><img src="__PUBLIC__/home/images/xing.png" width="16" height="15" /><span>{$val['avg']}</span></dd>
                        <dd>
                             <if condition="$val['role_id'] eq 0">个人车主
                                 <else/>个人货主
                             </if>
                        </dd>
                      </dl>
                      <div class="personne-right">
                          <a allow="1" href = "javascript:void(0)" onclick = "call_js(this,{$val['phone_number']},{$val['id']});" style="color:#333;">
                              <img src="__PUBLIC__/home/images/tel.png" width="22" height="22"/> 拨打电话
                          </a>
                      </div>
                   </div>
                   <div style="border:#C2C2C2 1px solid"></div>
                   <div class="describe">
                   <div class="dizhi"><img src="__PUBLIC__/home/images/lanse.png" width="20" height="23" /> <span>{$val['area1_str']}{$val['detail_area1']}</span></div>
                      <div class="describe-left">
                          <div class="column"><img src="__PUBLIC__/home/images/-1.png" width="22" height="18" /> 货物描述 <span>{$val['remark']}</span></div>
                          <div class="column"><img src="__PUBLIC__/home/images/21.png" width="22" height="20" /> 发布时间 <span>{$val['publish_time']}</span></div>
                          <div class="column"><img src="__PUBLIC__/home/images/-3.png" width="22" height="20" /> 有效时间 <span>{$val['publish_time']}</span></div>
                      </div>
                      <div class="describe-right">
                        <span>{$val['coal_quantity']}</span><a></a>
                      </div>
                   </div>
                 </span>
                 </div>
                 <volist name="list" id="val">
                  <div class="personne" style="margin-top: 0px;">
                      <input type="hidden" name="mid" value="{$val['id']}">
                      <dl class="personne-left">
                        <dt><if condition="$val['headimgurl'] eq ''">
                            <img src="__PUBLIC__/home/images/touxiang.png" width="55" style="border-radius: 50%;" height="57" /><else/>
                            <img src="__ROOT__{$val['headimgurl']}" width="55" style="border-radius: 50%;" height="57" />
                        </if></dt>
                        <dd class="userNameText">{$val['username']}<img src="__PUBLIC__/home/images/xing.png" width="16" height="15" /><span>{$val['avg']}</span></dd>
                        <dd>
                             <if condition="$val['role_id'] eq 0">个人车主
                                 <else/>个人货主
                             </if>
                        </dd>
                      </dl>
                      <div class="personne-right">
                          <a allow="{$val[is_allow]}" href = "javascript:void(0)" onclick = "call_js(this,{$val['phone_number']},{$val['id']});" style="color:#333;">
                              <img src="__PUBLIC__/home/images/tel.png" width="22" height="22"/> 拨打电话
                          </a>
                      </div>
                   </div>
                   <div class="describe"> 
                   <div class="dizhi"><img src="__PUBLIC__/home/images/lanse.png" width="20" height="23" />
                   <span>{$val['area1_str']}{$val['detail_area1']}</span>
                   </div>
                      <div class="describe-left">
                          <div class="column"><img src="__PUBLIC__/home/images/-1.png" width="22" height="18" /> 货物描述 <span>{$val['content']}</span></div>
                          <div class="column"><img src="__PUBLIC__/home/images/21.png" width="22" height="20" /> 发布时间 <span>{$val['publish_time']}</span></div>
                          <div class="column"><img src="__PUBLIC__/home/images/-3.png" width="22" height="20" /> 有效时间 <span>{$val['deline_time']}</span></div>
                      </div>
                      <div class="describe-right">
                        <span>{$val['coal_quantity']}</span><a><if condition="$val['coal_quantity'] neq 0">元</if></a>
                      </div>
                   </div>
                     <div style="border:#C2C2C2 1px solid"></div>
                   </volist>
                   </span>
                   <!--结束-->
               </div>
               <!--加载更多需要的数据开始-->
                   <input name="page" type="hidden" value="{$next}" id="nextPage"/>
                   <input name="orderCondition" type="hidden" value="{$orderCondition}" id="orderConditionId"/>
                   <input name="whereCase" type="hidden" value="{$whereCase}" id="whereCaseId"/>
                   <empty name="list">
                   <div style="background-color: #4AC9F6;text-align: center;height:30px;line-height:30px;color:#fff;">暂无数据</div>
                     <else/>
                   <div onclick="lodingMore()" style="background-color: #4AC9F6;text-align: center;height:30px;line-height:30px;color:#fff;">加载更多</div>
                   </empty>
               <!--加载更多需要的数据结束-->
              <!--全部结束-->
               </div>
      </div> 
   </div>
</div>
<div id="light" class="white_content" style="position: fixed;">
    <p class="worn">小矿建议您谨慎交易，"货"比三家哦！</p>
    <p class="tanceng_res" style=" margin-bottom: 8%">15020011277</p>
    <a href="tel:15020011277" class="call_you">拨号</a>
</div>
<div id="fade" class="black_overlay" style="height:1000%;" onclick = "document.getElementById('light').style.display='none';document.getElementById('fade').style.display='none'"></div>
<script type="text/javascript">
   function lodingMore(){
       var url="{:U('Home/Info/index')}";
       var formPage=$("#nextPage").val();
       var formOrderCondition=$("#orderConditionId").val();
       var formWhereCondition=$("#whereCaseId").val();
        $.ajax({
            type: "post",
            data:{isAjax:1,page:formPage,orderCondition:formOrderCondition,whereOrigin:formWhereCondition},
            url:url,
            success: function (data){
                var jsonObj=eval("("+data+")");
                 console.log(jsonObj.data);
                if(jsonObj.data==null||jsonObj.data==''){
                  tanchu("暂无数据");
                }else{
                    jQuery.each(jsonObj.data, function(k, val)
                    {
                        var tempObj=$("#cloneObj").clone(true);
                        tempObj.children("div").children("div").children("a").attr("onclick","call_js(this,"+val.phone_number+","+val.id+");");
                        tempObj.children("div").children("div").children("a").attr("allow",val.is_allow);
                        tempObj.children("div").children("input").val(val.id);
                        if(val.headimgurl==null){
                          tempObj.children("div").children("dl").children("dt").children("img").attr("src","__PUBLIC__/home/images/touxiang.png");
                        }else{
                        tempObj.children("div").children("dl").children("dt").children("img").attr("src","__ROOT__/"+val.headimgurl);
                        }
                        tempObj.children("div").children("dl").children("dd").children("span").eq(0).html(val.username);
                        tempObj.children("div").children("dl").children("dd").children("span").eq(1).html(val.avg);
                        tempObj.children("div").children("dl").children("dd").eq(1).html(val.role_name);
                        var addressStr1=val.area1_str;
                        if(addressStr1==null){
                          addressStr1="";
                        }
                        var addressStr2=val.detail_area1;
                        if(addressStr2==null){
                            addressStr2="";
                        }
                        tempObj.children("div").eq(2).children("div").children("span").html(addressStr1+addressStr2);
                        tempObj.children("div").eq(2).children("div .describe-left").children("div").eq(0).children("input").val(val.remark);
                        tempObj.children("div").eq(2).children("div .describe-left").children("div").eq(1).children("span").html(val.publish_time);
                        tempObj.children("div").eq(2).children("div .describe-left").children("div").eq(2).children("span").html(val.deline_time);
                        tempObj.children("div").eq(2).children("div .describe-right").children("span").html(val.coal_quantity);
                        if(val.coal_quantity!=null){
                           tempObj.children("div").eq(2).children("div .describe-right").children("a").html("元");
                        }
                        tempObj.appendTo("#inserPoint");
                    });
                    $("#nextPage").val(jsonObj.nextPage);
                    $("#orderConditionId").val(jsonObj.orderCondition);
                    $("#whereCaseId").val(jsonObj.whereCase);
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                tanchu("未知错误。");
            }
        });
   }
</script>
<script type="text/javascript">
    //拨打电话 电话号码的显示
    function call_js(obj,class_id,message)
    {
        var allowStr=$(obj).attr("allow");
        // alert(allowStr);
        if(allowStr==0){
             tanchu("不允许操作。");
             return;
        }
        document.getElementById('light').style.display='block';
        document.getElementById('fade').style.display='block';
        var phone_res = class_id;
        $(".tanceng_res").html(phone_res);
        var link = "tel:"+phone_res;
        $('.call_you').attr('href',link);
        var url="__CONTROLLER__/ajax_order_goods";
        $.ajax({
          type:"post",
          url:url,
          data:{message:message},
          success:function(data){
              if(data!=""){
                  var jsonObj=eval("("+data+")");
                  if(jsonObj==1){
                     tanchu("接单成功。");
                  }else{
                    tanchu(jsonObj.msg);
                  }
              }else{
                tanchu("操作失败。");
              }
          },
          error:function(XMLHttpRequest,textStatus,errorThrown){
             tanchu("操作失败。");
          }
         });
    }
</script>
</body>
</html>
